<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multiplier Logic Test</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #0f0;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #0f0;
        }
        .pass {
            color: #0f0;
        }
        .fail {
            color: #f00;
        }
        h2 {
            color: #ff0;
        }
    </style>
</head>
<body>
    <h1>Iron Turtle - Multiplier Logic Test Suite</h1>
    <div id="test-results"></div>

    <!-- Load the necessary scripts -->
    <script src="js/activities.js"></script>
    <script src="js/data-utils.js"></script>
    <script src="js/scoring.js"></script>
    
    <script>
        const results = document.getElementById('test-results');
        let testsPassed = 0;
        let totalTests = 0;

        function runTest(description, testFn) {
            totalTests++;
            try {
                const result = testFn();
                if (result === true) {
                    testsPassed++;
                    results.innerHTML += `<div class="test-result pass">‚úì PASS: ${description}</div>`;
                } else {
                    results.innerHTML += `<div class="test-result fail">‚úó FAIL: ${description}<br>Result: ${JSON.stringify(result)}</div>`;
                }
            } catch (error) {
                results.innerHTML += `<div class="test-result fail">‚úó ERROR: ${description}<br>Error: ${error.message}</div>`;
            }
        }

        // Test 1: Check if drink activities get consumable multipliers
        runTest("Drink (Beer) should get boat multiplier (consumable-only)", () => {
            const beer = ACTIVITIES.consumables.find(a => a.id === 'beer');
            const boatMultiplier = MULTIPLIERS.find(m => m.id === 'boat');
            return DataUtils.canApplyMultiplier(beer, boatMultiplier) === true;
        });

        // Test 2: Check if food activities get consumable multipliers
        runTest("Food (Hot Dog) should get water multiplier (consumable-only)", () => {
            const hotDog = ACTIVITIES.consumables.find(a => a.id === 'hot_dog');
            const waterMultiplier = MULTIPLIERS.find(m => m.id === 'water');
            return DataUtils.canApplyMultiplier(hotDog, waterMultiplier) === true;
        });

        // Test 3: Check if drinks don't get non-applicable multipliers
        runTest("Drink (Wine) should NOT get USC multiplier when appliesToConsumables is false", () => {
            const wine = ACTIVITIES.consumables.find(a => a.id === 'wine');
            // Temporarily modify USC to test logic
            const uscMultiplier = {...MULTIPLIERS.find(m => m.id === 'usc'), appliesToConsumables: false};
            return DataUtils.canApplyMultiplier(wine, uscMultiplier) === false;
        });

        // Test 4: Check if competitions get universal multipliers
        runTest("Competition (Beer Pong) should get USC multiplier (universal)", () => {
            const beerPong = ACTIVITIES.competitions.find(a => a.id === 'beer_pong');
            const uscMultiplier = MULTIPLIERS.find(m => m.id === 'usc');
            return DataUtils.canApplyMultiplier(beerPong, uscMultiplier) === true;
        });

        // Test 5: Check if competitions don't get consumable-only multipliers
        runTest("Competition (Cornhole) should NOT get boat multiplier (consumable-only)", () => {
            const cornhole = ACTIVITIES.competitions.find(a => a.id === 'cornhole');
            const boatMultiplier = MULTIPLIERS.find(m => m.id === 'boat');
            return DataUtils.canApplyMultiplier(cornhole, boatMultiplier) === false;
        });

        // Test 6: Check multiplier stacking
        runTest("Multipliers should stack multiplicatively (2x * 3x = 6x)", () => {
            const beer = ACTIVITIES.consumables.find(a => a.id === 'beer');
            const points = DataUtils.calculatePoints(beer, ['boat', 'latenight'], 1, {});
            // Beer is 1 point base, boat is 2x, latenight is 3x = 6 points
            return points === 6;
        });

        // Test 7: Check triple stacking
        runTest("Three multipliers should stack correctly (2x * 2x * 4x = 16x)", () => {
            const shot = ACTIVITIES.consumables.find(a => a.id === 'shot');
            const points = DataUtils.calculatePoints(shot, ['boat', 'usc', 'island'], 1, {});
            // Shot is 2 points base, boat is 2x, usc is 2x, island is 4x = 32 points
            return points === 32;
        });

        // Test 8: Check quantity multiplication
        runTest("Quantity should multiply final points", () => {
            const beer = ACTIVITIES.consumables.find(a => a.id === 'beer');
            const points = DataUtils.calculatePoints(beer, ['boat'], 3, {});
            // Beer is 1 point base, boat is 2x, quantity is 3 = 6 points
            return points === 6;
        });

        // Test 9: Test with no multipliers
        runTest("Activity with no multipliers should return base points", () => {
            const beerPong = ACTIVITIES.competitions.find(a => a.id === 'beer_pong');
            const points = DataUtils.calculatePoints(beerPong, [], 1, { competitionResult: 'win' });
            // Beer Pong win is 30 points base
            return points === 30;
        });

        // Test 10: Test penalty (which shouldn't get multipliers)
        runTest("Penalty should not be affected by multipliers", () => {
            const spill = ACTIVITIES.penalties.find(a => a.id === 'spill_own_drink');
            const points = DataUtils.calculatePoints(spill, ['boat', 'usc'], 1, {});
            // Spill is -5 points, should remain -5 regardless of multipliers
            return points === -5;
        });

        // Summary
        results.innerHTML += `<h2>Test Summary: ${testsPassed}/${totalTests} tests passed</h2>`;
        if (testsPassed === totalTests) {
            results.innerHTML += `<div class="test-result pass">üéâ All tests passed! Multiplier logic is working correctly.</div>`;
        } else {
            results.innerHTML += `<div class="test-result fail">‚ö†Ô∏è Some tests failed. Please review the results above.</div>`;
        }
    </script>
</body>
</html>